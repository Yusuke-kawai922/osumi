<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10月度 月次レポート</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#1E40AF', // 落ち着いた深い青
                            light: '#EFF6FF',
                        },
                        accent: {
                            teal: '#0D9488',
                            warm: '#A8A29E',
                        },
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #FAFAFA;
            color: #1F2937;
            -webkit-text-size-adjust: 100%;
        }
        .tracking-wide-num { letter-spacing: -0.02em; }
    </style>
</head>

<!-- pb-20に変更し、フッターの高さに合わせてスクロールの止まり位置を調整 -->
<body class="antialiased pb-20">

    <div class="max-w-md mx-auto min-h-screen bg-white border-x border-gray-100">

        <!-- ヘッダー -->
        <header class="pt-10 px-6 pb-6 bg-white">
            <div class="border-b border-gray-100 pb-6">
                <p class="text-xs font-bold text-gray-500 mb-2 tracking-widest">MONTHLY REPORT</p>
                <div class="flex justify-between items-end">
                    <h1 class="text-3xl font-bold text-gray-900">10月度<br>結果報告</h1>
                    <div class="text-right">
                        <p class="text-sm font-bold text-gray-900">山田 太郎 様</p>
                        <p class="text-xs text-gray-500 mt-1">10/1 - 10/31</p>
                    </div>
                </div>
            </div>

            <!-- 進捗バー -->
            <div class="pt-6">
                <div class="flex justify-between items-end mb-2">
                    <span class="text-sm font-bold text-gray-900">ゴール到達度</span>
                    <span class="text-2xl font-bold text-primary tracking-wide-num">45<span class="text-sm text-gray-500 ml-1">%</span></span>
                </div>
                <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
                    <div class="bg-primary h-full rounded-full" style="width: 45%;"></div>
                </div>
                <p class="mt-3 text-sm text-gray-600 leading-relaxed bg-primary-light p-3 rounded-lg border border-blue-100">
                    順調です。3ヶ月コースの折り返し地点を通過しました。
                </p>
            </div>
        </header>

        <div class="px-6 space-y-12 mt-4">

            <!-- 1. 成果 (Result) - グラフ追加 -->
            <section>
                <h2 class="text-sm font-bold text-gray-500 tracking-widest mb-4 uppercase">01 / Result</h2>
                
                <!-- 数値グリッド -->
                <div class="grid grid-cols-2 gap-8 py-4 border-t border-gray-100">
                    <div>
                        <p class="text-xs text-gray-500 font-bold mb-1">体重</p>
                        <div class="flex items-baseline">
                            <span class="text-4xl font-bold text-gray-900 tracking-wide-num">58.2</span>
                            <span class="text-sm text-gray-500 ml-1">kg</span>
                        </div>
                        <p class="text-sm font-bold text-primary mt-1">−1.2 kg</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 font-bold mb-1">体脂肪率</p>
                        <div class="flex items-baseline">
                            <span class="text-4xl font-bold text-gray-900 tracking-wide-num">28.0</span>
                            <span class="text-sm text-gray-500 ml-1">%</span>
                        </div>
                        <p class="text-sm font-bold text-primary mt-1">−0.5 %</p>
                    </div>
                </div>

                <!-- グラフエリア -->
                <div class="mb-6 pt-2 pb-6 border-b border-gray-100">
                    <!-- タブ切り替え -->
                    <div class="flex gap-2 mb-4">
                        <button onclick="switchChart('weight')" id="tab-weight" class="px-4 py-1.5 rounded-full text-xs font-bold transition-colors bg-primary text-white">
                            体重推移
                        </button>
                        <button onclick="switchChart('fat')" id="tab-fat" class="px-4 py-1.5 rounded-full text-xs font-bold transition-colors bg-gray-100 text-gray-500 hover:bg-gray-200">
                            体脂肪率
                        </button>
                    </div>
                    
                    <!-- チャートキャンバス -->
                    <div class="relative w-full h-48">
                        <canvas id="resultChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- 2. 要因 (Analysis) -->
            <section>
                <h2 class="text-sm font-bold text-gray-500 tracking-widest mb-4 uppercase">02 / Analysis</h2>
                <div class="bg-gray-50 rounded-lg p-5 border border-gray-100">
                    <p class="text-sm font-bold text-gray-900 mb-4">今月の成功要因</p>
                    
                    <!-- 分割バーグラフ -->
                    <div class="flex w-full h-4 rounded-full overflow-hidden mb-5 bg-gray-200">
                        <div class="bg-primary h-full" style="width: 40%;"></div>
                        <div class="bg-accent-teal h-full" style="width: 30%;"></div>
                        <div class="bg-accent-warm h-full" style="width: 20%;"></div>
                        <div class="bg-gray-400 h-full" style="width: 10%;"></div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="w-2 h-2 rounded-full bg-primary"></span>
                                    <span class="text-sm font-bold text-gray-900">食事管理 (40%)</span>
                                </div>
                                <p class="text-xs text-gray-600 pl-4">夜の糖質制限が数値減少のベースを作りました。</p>
                            </div>
                        </div>
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="w-2 h-2 rounded-full bg-accent-teal"></span>
                                    <span class="text-sm font-bold text-gray-900">脚トレーニング (30%)</span>
                                </div>
                                <p class="text-xs text-gray-600 pl-4">スクワット等での「基礎代謝アップ」が効いています。</p>
                            </div>
                        </div>
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="w-2 h-2 rounded-full bg-accent-warm"></span>
                                    <span class="text-sm font-bold text-gray-900">有酸素・歩数 (20%)</span>
                                </div>
                                <p class="text-xs text-gray-600 pl-4">通勤時の歩行が脂肪燃焼を加速させました。</p>
                            </div>
                        </div>
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="w-2 h-2 rounded-full bg-gray-400"></span>
                                    <span class="text-sm font-bold text-gray-900">背中・姿勢 (10%)</span>
                                </div>
                                <p class="text-xs text-gray-600 pl-4">姿勢改善によるウエストラインの変化に貢献。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. 動画ログ (全表示リスト・スクロールなし) -->
            <section>
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-sm font-bold text-gray-500 tracking-widest uppercase">03 / Video Log</h2>
                    <span class="text-xs bg-primary-light text-primary px-2 py-1 rounded font-bold">全5種目</span>
                </div>
                
                <!-- 動画プレーヤーエリア（固定） -->
                <div id="playerContainer" class="mb-4 sticky top-0 bg-white z-10 pt-2 pb-2">
                    <!-- JSで描画 -->
                </div>

                <!-- リストエリア（個別スクロールなし・全表示） -->
                <div class="border border-gray-200 rounded-lg overflow-hidden">
                    <div class="bg-gray-50 px-4 py-2 border-b border-gray-200">
                        <p class="text-xs font-bold text-gray-500">セッションメニュー (タップして再生)</p>
                    </div>
                    <!-- 高さ指定なし、中身に応じて伸びる -->
                    <div class="bg-white" id="playlistContainer">
                        <!-- JSで描画 -->
                    </div>
                </div>
            </section>

            <!-- 4. 次月 (Next) -->
            <section>
                <h2 class="text-sm font-bold text-gray-500 tracking-widest mb-4 uppercase">04 / Next Step</h2>
                <div class="border border-gray-200 rounded-lg p-6">
                    <p class="text-xs font-bold text-primary mb-2">来月のテーマ</p>
                    <h3 class="text-xl font-bold text-gray-900 mb-3">背中の引き締め</h3>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        下半身の基礎はできました。来月は姿勢改善も兼ねて背中を鍛え、ウエストラインを強調します。
                    </p>
                </div>
            </section>

        </div>

        <!-- フッター -->
        <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-100 p-4 z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
            <div class="max-w-md mx-auto">
                <button class="w-full py-3 border border-gray-300 rounded-md text-sm font-bold text-gray-700 flex items-center justify-center gap-2 hover:bg-gray-50 transition-colors">
                    <i data-lucide="share" class="w-4 h-4"></i>
                    レポートを保存・共有
                </button>
            </div>
        </div>

    </div>

    <script>
        lucide.createIcons();

        /* --- Chart.js 設定 --- */
        let chartInstance = null;
        const chartCtx = document.getElementById('resultChart').getContext('2d');

        // データ定義
        const chartLabels = ['9/01', '9/15', '10/01', '10/15', '10/31'];
        const dataWeight = [60.5, 60.0, 59.2, 58.8, 58.2];
        const dataFat = [29.5, 29.0, 28.8, 28.5, 28.0];

        function initChart() {
            chartInstance = new Chart(chartCtx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: '体重 (kg)',
                        data: dataWeight,
                        borderColor: '#1E40AF', // Primary Color
                        backgroundColor: 'rgba(30, 64, 175, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#1E40AF',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1F2937',
                            titleFont: { family: "'Noto Sans JP', sans-serif" },
                            bodyFont: { family: "'Noto Sans JP', sans-serif", weight: 'bold' },
                            padding: 10,
                            cornerRadius: 4,
                            displayColors: false,
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: '#F3F4F6' },
                            ticks: { font: { size: 10 }, color: '#9CA3AF' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 10 }, color: '#9CA3AF' }
                        }
                    }
                }
            });
        }

        // グラフ切り替え処理
        window.switchChart = function(type) {
            const btnWeight = document.getElementById('tab-weight');
            const btnFat = document.getElementById('tab-fat');

            if (type === 'weight') {
                // UI更新
                btnWeight.className = "px-4 py-1.5 rounded-full text-xs font-bold transition-colors bg-primary text-white";
                btnFat.className = "px-4 py-1.5 rounded-full text-xs font-bold transition-colors bg-gray-100 text-gray-500 hover:bg-gray-200";
                
                // データ更新
                chartInstance.data.datasets[0].label = '体重 (kg)';
                chartInstance.data.datasets[0].data = dataWeight;
                chartInstance.data.datasets[0].borderColor = '#1E40AF';
                chartInstance.data.datasets[0].pointBorderColor = '#1E40AF';
                chartInstance.data.datasets[0].backgroundColor = 'rgba(30, 64, 175, 0.1)';
            } else {
                // UI更新
                btnWeight.className = "px-4 py-1.5 rounded-full text-xs font-bold transition-colors bg-gray-100 text-gray-500 hover:bg-gray-200";
                btnFat.className = "px-4 py-1.5 rounded-full text-xs font-bold transition-colors bg-accent-teal text-white";
                
                // データ更新
                chartInstance.data.datasets[0].label = '体脂肪率 (%)';
                chartInstance.data.datasets[0].data = dataFat;
                chartInstance.data.datasets[0].borderColor = '#0D9488'; // Teal Color
                chartInstance.data.datasets[0].pointBorderColor = '#0D9488';
                chartInstance.data.datasets[0].backgroundColor = 'rgba(13, 148, 136, 0.1)';
            }
            chartInstance.update();
        }

        /* --- 動画ログ処理 --- */
        const videoData = [
            {
                id: 1,
                title: "ブルガリアンスクワット",
                date: "10/15 撮影",
                point: "膝が内側に入らないよう修正しました。「お尻に乗る感覚」を意識してください。",
                isChecked: false
            },
            {
                id: 2,
                title: "ラットプルダウン",
                date: "10/15 撮影",
                point: "肩がすくまないように、胸を張りながら引き下げましょう。脇を締めるイメージです。",
                isChecked: false
            },
            {
                id: 3,
                title: "プランク",
                date: "10/01 撮影",
                point: "腰が反っています。お腹に力を入れて、背中を平らに保つ意識を持ちましょう。",
                isChecked: false
            },
            {
                id: 4,
                title: "ダンベルプレス",
                date: "10/01 撮影",
                point: "下ろす位置が深すぎると肩を痛めます。肘が90度になる位置で止めましょう。",
                isChecked: false
            },
            {
                id: 5,
                title: "ウォーキングランジ",
                date: "10/01 撮影",
                point: "上半身が前に倒れすぎています。目線を上げて、胸を張ったまま踏み出しましょう。",
                isChecked: false
            }
        ];

        let currentIndex = 0;

        function initVideoLog() {
            renderPlayer();
            renderList();
        }

        function renderPlayer() {
            const data = videoData[currentIndex];
            const container = document.getElementById('playerContainer');
            
            container.innerHTML = `
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden shadow-sm">
                    <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                        <span class="text-lg font-bold text-gray-900">${data.title}</span>
                        <span class="text-xs text-gray-500">${data.date}</span>
                    </div>
                    
                    <div class="relative w-full aspect-video bg-gray-900 flex items-center justify-center">
                        <div class="w-14 h-14 bg-white/90 rounded-full flex items-center justify-center shadow-lg cursor-pointer hover:scale-105 transition-transform">
                            <i data-lucide="play" class="w-6 h-6 text-gray-900 fill-current ml-1"></i>
                        </div>
                    </div>

                    <div class="p-4">
                        <div class="flex gap-3 mb-4">
                            <i data-lucide="lightbulb" class="w-5 h-5 text-primary flex-shrink-0 mt-0.5"></i>
                            <p class="text-sm text-gray-800 font-medium leading-relaxed">
                                ${data.point}
                            </p>
                        </div>
                        
                        <button onclick="toggleCheck(${currentIndex})" class="w-full py-3 rounded-md text-sm font-bold flex items-center justify-center gap-2 transition-all ${data.isChecked ? 'bg-primary text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}">
                            ${data.isChecked ? '<i data-lucide="check-circle" class="w-4 h-4"></i> 確認しました' : '<i data-lucide="check" class="w-4 h-4"></i> 自宅で復習したらチェック'}
                        </button>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        function renderList() {
            const container = document.getElementById('playlistContainer');
            
            // 最後のアイテムかどうかをチェックして、border-bの有無を切り替える
            container.innerHTML = videoData.map((item, index) => `
                <div onclick="selectVideo(${index})" id="item-${index}" class="flex items-center justify-between p-4 ${index === videoData.length - 1 ? '' : 'border-b border-gray-100'} cursor-pointer transition-colors ${index === currentIndex ? 'bg-primary-light' : 'bg-white hover:bg-gray-50'}">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${index === currentIndex ? 'bg-primary text-white' : 'bg-gray-200 text-gray-500'}">
                            <i data-lucide="${index === currentIndex ? 'play' : 'video'}" class="w-4 h-4 ${index === currentIndex ? 'fill-current' : ''}"></i>
                        </div>
                        <div>
                            <p class="text-sm font-bold ${index === currentIndex ? 'text-primary' : 'text-gray-900'}">${item.title}</p>
                            ${item.isChecked ? '<p class="text-xs text-primary font-bold mt-0.5">✓ 確認済み</p>' : ''}
                        </div>
                    </div>
                    ${index === currentIndex ? '<span class="text-xs font-bold text-primary bg-white px-2 py-1 rounded border border-blue-100">選択中</span>' : '<i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i>'}
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        function selectVideo(index) {
            currentIndex = index;
            renderPlayer();
            renderList();
            
            // プレーヤー位置までスクロール
            const player = document.getElementById('playerContainer');
            const offset = 80; 
            const elementPosition = player.getBoundingClientRect().top + window.scrollY;
            const offsetPosition = elementPosition - offset;

            window.scrollTo({
                top: offsetPosition,
                behavior: "smooth"
            });
        }

        function toggleCheck(index) {
            videoData[index].isChecked = !videoData[index].isChecked;
            renderPlayer();
            renderList();
        }

        // 初期化実行
        initChart();
        initVideoLog();

    </script>
</body>
</html>
